## Java 结构

## 包

### 按功能划分包而不是按层划分包

https://phauer.com/2020/package-by-feature/


### 不同模块中的包路径应相同，模块只是隔离依赖关系

在 IDEA 中可以切换为包视图，在这个视图下相关功能的类应在一起，体现高内聚。

不同的模块是为了隔离依赖，比如 DDD 中 proxy 模块依赖了外部 api 和内部 api 提供服务，
其他模块不能 import 外部 api 的内容，就不会被外部 api 污染，体现低耦合。


### 使用`package-info.java`配合文档注释说明包的作用


## 类

### 少用嵌套类，不同文件更直观

### 一个文件的代码行数一个屏幕（Google 王争）


## 方法

### 不应该在一个文件中有多个方法，除非方法之间没有依赖，或者由上到下依赖

在一个类中增加方法时应十分克制，鼓励添加而不是修改，体现开闭原则。

如果不能在 3 分钟内理直接清楚方法之间的关系那么方法关系就太复杂了


### 方法依赖的公共方法可以用包可见封装到多个文件中

包可见也便于单元测试


### 字段赋值方法不要放在业务程序里，避免影响主逻辑的阅读

```regexp
set([^(]++)\([^.]++\.get\1\(
```

### 使用 protected 而不是 private

1. private 不便于单元测试。
2. 体现对拓展开放，否则装饰者继承无法使用 private 的内容，就不得不复制代码。
3. Sonar 也是提示改成 protected 而不是 private。


### 养成 Utils 类第一句就 private 构造方法的习惯


### 预定义语句可以抽取成卫语句方法

```
String a;
if ... {
    a = ...
} else if {
    a = ... 
} else if {
    ...
```

抽取成：
```
String foo() {
if (...) {
    return ...
} else if {
    return ... 
} else if {
    ...
```

while 预定义除外

### switch 较多时抽取成方法，减少 break